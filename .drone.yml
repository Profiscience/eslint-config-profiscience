on_push: &on_push
  when:
    event:
      - push

kind: pipeline
name: default

trigger:
  branch:
    - master

steps:
  - name: bump
    image: node:lts
    <<: *on_push
    commands:
      - git config --global user.name "Drone CI"
      - git config --global user.email buildbot@ci.caseywebb.xyz
      - npm version patch

  - name: push
    image: appleboy/drone-git-push
    <<: *on_push
    settings:
      remote_name: origin
      follow_tags: true

  - name: publish
    image: plugins/npm
    when:
      event:
        - tag
    settings:
      token:
        from_secret: NPM_TOKEN

---
kind: secret
name: NPM_TOKEN
data: Yy4txZ8nNaIirwbldt0l8P1vJjo/Tv6NWuqBjx6oXsROA2HjKxxLHCEHSkrCfjmxhHzjGr8ebsv5gdw3RPztbQ==
